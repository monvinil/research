<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Methods - Research Engine</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

  :root {
    --bg: #050507;
    --surface: rgba(255,255,255,0.03);
    --surface-hover: rgba(255,255,255,0.055);
    --glass: rgba(255,255,255,0.04);
    --glass-border: rgba(255,255,255,0.06);
    --glass-border-hover: rgba(255,255,255,0.12);
    --text: #f0f0f5;
    --text-secondary: #8b8b9e;
    --dim: #55556a;
    --accent: #a78bfa;
    --accent-glow: rgba(167,139,250,0.15);
    --green: #34d399;
    --green-dim: rgba(52,211,153,0.1);
    --red: #f87171;
    --red-dim: rgba(248,113,113,0.08);
    --amber: #fbbf24;
    --amber-dim: rgba(251,191,36,0.08);
    --blue: #60a5fa;
    --blue-dim: rgba(96,165,250,0.08);
    --cyan: #22d3ee;
    --cyan-dim: rgba(34,211,238,0.08);
    --orange: #fb923c;
    --orange-dim: rgba(251,146,60,0.08);
    --gradient-1: linear-gradient(135deg, rgba(167,139,250,0.12) 0%, rgba(96,165,250,0.08) 50%, rgba(52,211,153,0.06) 100%);
    --gradient-accent: linear-gradient(135deg, #a78bfa, #818cf8, #60a5fa);
    --radius: 16px;
    --radius-sm: 10px;
    --blur: 20px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    font-size: 14px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Ambient glow */
  body::before {
    content: '';
    position: fixed;
    top: -40%;
    left: -20%;
    width: 80%;
    height: 80%;
    background: radial-gradient(ellipse, rgba(167,139,250,0.04) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -30%;
    right: -20%;
    width: 70%;
    height: 70%;
    background: radial-gradient(ellipse, rgba(52,211,153,0.03) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 960px;
    margin: 0 auto;
    padding: 24px 16px;
    padding-top: max(24px, env(safe-area-inset-top));
    padding-bottom: max(24px, env(safe-area-inset-bottom));
    position: relative;
    z-index: 1;
  }

  /* ─── Nav ─── */
  nav {
    display: flex;
    gap: 2px;
    margin-bottom: 28px;
    background: var(--glass);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 3px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  nav a {
    flex: 1;
    color: var(--dim);
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 9px;
    transition: all 0.2s;
    text-align: center;
    white-space: nowrap;
  }
  nav a:hover { color: var(--text-secondary); }
  nav a.active {
    background: rgba(255,255,255,0.06);
    color: var(--text);
  }

  /* ─── Header ─── */
  header { margin-bottom: 24px; }
  h1 {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 2px;
    background: var(--gradient-accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .subtitle { color: var(--dim); font-size: 13px; }

  /* ─── Glass card base ─── */
  .glass {
    background: var(--glass);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    transition: border-color 0.2s, background 0.2s;
  }
  .glass:hover {
    border-color: var(--glass-border-hover);
    background: var(--surface-hover);
  }

  /* ─── Stat cards ─── */
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 12px;
  }
  .stat-card {
    padding: 16px;
    text-align: center;
  }
  .stat-label {
    font-size: 10px;
    color: var(--dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
    margin-bottom: 4px;
  }
  .stat-value {
    font-size: 28px;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    letter-spacing: -1px;
  }

  /* ─── Page intro ─── */
  .page-intro {
    color: var(--text-secondary);
    font-size: 12px;
    line-height: 1.7;
    margin-bottom: 16px;
    padding: 16px 20px;
  }
  .page-intro strong { color: var(--text); font-weight: 600; }

  /* ─── Bento grid ─── */
  .bento {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 12px;
  }
  .bento-wide { grid-column: 1 / -1; }
  .bento-item { padding: 20px; }

  /* ─── Section labels ─── */
  .section-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--dim);
    font-weight: 600;
    margin-bottom: 10px;
  }
  .section-hint {
    font-weight: 400;
    letter-spacing: 0;
    text-transform: none;
    color: var(--dim);
    margin-left: 6px;
    font-size: 10px;
  }

  /* ─── Category summary chips ─── */
  .cat-summary {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }
  .cat-chip {
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    text-align: center;
    min-width: 110px;
    flex: 1;
  }
  .cat-chip-name { font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
  .cat-chip-count { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; }
  .cat-chip-disc { font-size: 10px; opacity: 0.8; }

  /* ─── Category filters ─── */
  .cat-filters {
    display: flex;
    gap: 6px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }
  .cat-btn {
    padding: 5px 14px;
    border-radius: 100px;
    border: 1px solid var(--glass-border);
    background: var(--glass);
    color: var(--dim);
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
  }
  .cat-btn:hover { border-color: rgba(167,139,250,0.3); color: var(--text-secondary); }
  .cat-btn.active { border-color: rgba(167,139,250,0.3); color: var(--accent); background: var(--accent-glow); }

  /* ─── Method card ─── */
  .method-card {
    padding: 20px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
  }
  .method-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    border-radius: 3px;
    background: var(--accent);
  }
  .method-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
    gap: 12px;
  }
  .method-name { font-weight: 600; font-size: 14px; }
  .method-cat {
    font-size: 9px;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 100px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .cat-economic_theory { background: var(--accent-glow); color: var(--accent); }
  .cat-math_model { background: var(--cyan-dim); color: var(--cyan); }
  .cat-data_source { background: var(--blue-dim); color: var(--blue); }
  .cat-analytical_lens { background: var(--orange-dim); color: var(--orange); }
  .cat-discovery_method { background: var(--green-dim); color: var(--green); }

  .method-desc { color: var(--text-secondary); font-size: 12px; margin-bottom: 12px; line-height: 1.6; }

  /* ─── Success rate bar ─── */
  .rate-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
  }
  .rate-label { font-size: 11px; color: var(--dim); min-width: 80px; }
  .rate-bar-bg {
    flex: 1;
    height: 20px;
    background: rgba(255,255,255,0.03);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }
  .rate-bar-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.3s;
  }
  .rate-ci {
    position: absolute;
    top: 0;
    height: 100%;
    border-radius: 6px;
    background: rgba(255,255,255,0.04);
  }
  .rate-val { min-width: 46px; font-size: 13px; font-weight: 700; font-variant-numeric: tabular-nums; }

  /* ─── Mini stats ─── */
  .method-stats {
    display: flex;
    gap: 14px;
    margin-bottom: 8px;
    flex-wrap: wrap;
  }
  .ms { font-size: 11px; color: var(--dim); }
  .ms strong { color: var(--text-secondary); font-weight: 600; }

  /* ─── Discovery list ─── */
  .discovery-list { margin-top: 10px; }
  .disc-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    font-size: 12px;
  }
  .disc-item:last-child { border-bottom: none; }
  .disc-cycle {
    font-size: 9px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 100px;
    background: var(--accent-glow);
    color: var(--accent);
    flex-shrink: 0;
  }
  .disc-desc { color: var(--text-secondary); flex: 1; font-size: 11px; }
  .disc-score {
    font-size: 11px;
    font-weight: 700;
    color: var(--green);
    flex-shrink: 0;
    min-width: 30px;
    text-align: right;
  }

  /* ─── Exploration candidates ─── */
  .explore-card {
    background: var(--amber-dim);
    border: 1px solid rgba(251,191,36,0.15);
    border-radius: var(--radius-sm);
    padding: 14px 18px;
    margin-bottom: 8px;
  }
  .explore-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
    gap: 12px;
  }
  .explore-name { font-weight: 600; font-size: 12px; color: var(--amber); }
  .explore-meta { font-size: 11px; color: var(--dim); }
  .explore-rec { font-size: 11px; color: var(--amber); margin-top: 2px; opacity: 0.85; }

  /* ─── Allocation bars ─── */
  .alloc-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
  }
  .alloc-name {
    min-width: 140px;
    font-size: 11px;
    color: var(--dim);
    text-align: right;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .alloc-bar-bg {
    flex: 1;
    height: 14px;
    background: rgba(255,255,255,0.03);
    border-radius: 4px;
    overflow: hidden;
  }
  .alloc-bar-fill {
    height: 100%;
    border-radius: 4px;
    background: var(--gradient-accent);
  }
  .alloc-val { min-width: 30px; font-size: 11px; font-weight: 700; color: var(--text-secondary); }

  .empty { text-align: center; padding: 32px 16px; color: var(--dim); font-size: 12px; }

  /* ─── Responsive ─── */
  @media (max-width: 640px) {
    .container { padding: 16px 12px; }
    h1 { font-size: 20px; }
    .stat-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
    .stat-card { padding: 14px 12px; }
    .stat-value { font-size: 24px; }
    .bento { grid-template-columns: 1fr; }
    .bento-item { padding: 16px; }
    .cat-summary { gap: 6px; }
    .cat-chip { min-width: 90px; padding: 10px 12px; }
    .cat-chip-count { font-size: 18px; }
    .method-header { flex-direction: column; gap: 6px; }
    .method-stats { gap: 8px; }
    .rate-label { min-width: 70px; font-size: 10px; }
    .alloc-name { min-width: 100px; font-size: 10px; }
  }

  @media print {
    body::before, body::after { display: none; }
    :root { --bg:#fff; --glass:transparent; --glass-border:#ddd; --text:#111; --text-secondary:#444; --dim:#666; }
    body { background:#fff; color:#111; }
    nav { display:none !important; }
    .glass { backdrop-filter: none; -webkit-backdrop-filter: none; background: #f8f8f8; }
  }
</style>
</head>
<body>
<div class="container">
  <nav>
    <a href="index.html">Dashboard</a>
    <a href="ops.html">Operations</a>
    <a href="findings.html">Findings</a>
    <a href="methods.html" class="active">Methods</a>
  </nav>

  <header>
    <h1>Methodology Tracker</h1>
    <div class="subtitle">Exploration / exploitation allocation across analytical approaches</div>
  </header>

  <div class="glass page-intro">
    Each analytical method (economic theory, data source, discovery approach) is tracked as a <strong>multi-armed bandit</strong>.
    Success rates update after every cycle based on whether the method produced a discovery. <strong>Thompson sampling</strong>
    allocates future cycle attention toward methods with the best risk-adjusted payoff. High-uncertainty methods
    get exploration bonus.
  </div>

  <!-- Stats -->
  <div class="stat-grid">
    <div class="glass stat-card">
      <div class="stat-label">Methods</div>
      <div class="stat-value" id="s-methods" style="color:var(--accent)">0</div>
    </div>
    <div class="glass stat-card">
      <div class="stat-label">Applications</div>
      <div class="stat-value" id="s-applications">0</div>
    </div>
    <div class="glass stat-card">
      <div class="stat-label">Discoveries</div>
      <div class="stat-value" id="s-discoveries" style="color:var(--green)">0</div>
    </div>
    <div class="glass stat-card">
      <div class="stat-label">Avg Success</div>
      <div class="stat-value" id="s-avg-rate" style="color:var(--amber)">0%</div>
    </div>
  </div>

  <!-- Category summary -->
  <div class="cat-summary" id="cat-summary"></div>

  <!-- Category filters -->
  <div class="cat-filters" id="cat-filters">
    <button class="cat-btn active" data-cat="all">All</button>
  </div>

  <!-- Exploration candidates -->
  <section id="explore-section" style="display:none; margin-bottom: 16px;">
    <div class="section-label">Needs More Testing <span class="section-hint">wide confidence interval, exploration bonus active</span></div>
    <div id="explore-list"></div>
  </section>

  <!-- All methods -->
  <section style="margin-bottom: 16px;">
    <div class="section-label">All Methodologies</div>
    <div id="method-list"><div class="empty">No methodology data</div></div>
  </section>

  <!-- Allocation + Log -->
  <div class="bento">
    <div class="glass bento-item">
      <div class="section-label">Thompson Sampling Allocation <span class="section-hint">next cycle</span></div>
      <div id="alloc-chart"><div class="empty">No allocation data</div></div>
    </div>
    <div class="glass bento-item">
      <div class="section-label">Recent Applications</div>
      <div id="cycle-log"><div class="empty">No application log</div></div>
    </div>
  </div>
</div>

<script>
const TRACKER_URL = '../data/context/methodology_tracker.json';
let allData = null;
let activeCategory = 'all';

const CAT_COLORS = {
  economic_theory: {bg:'var(--accent-glow)',fg:'var(--accent)'},
  math_model: {bg:'var(--cyan-dim)',fg:'var(--cyan)'},
  data_source: {bg:'var(--blue-dim)',fg:'var(--blue)'},
  analytical_lens: {bg:'var(--orange-dim)',fg:'var(--orange)'},
  discovery_method: {bg:'var(--green-dim)',fg:'var(--green)'},
};

const CAT_LABELS = {
  economic_theory: 'Econ Theory',
  math_model: 'Math Model',
  data_source: 'Data Source',
  analytical_lens: 'Analytical Lens',
  discovery_method: 'Discovery Method',
};

function esc(s) { if(!s) return ''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }

function successRate(m) {
  if (!m) return 0;
  const total = (m.alpha||1) + (m.beta||1);
  return (m.alpha||1) / total;
}

function confidenceInterval(m) {
  const a = m.alpha||1, b = m.beta||1;
  const n = a + b;
  const mean = a / n;
  if (n < 3) return {mean, low:0, high:1};
  const std = Math.sqrt(a * b / (n * n * (n + 1)));
  const z = 1.645;
  return {
    mean,
    low: Math.max(0, mean - z * std),
    high: Math.min(1, mean + z * std),
  };
}

function rateColor(rate) {
  if (rate >= 0.6) return 'var(--green)';
  if (rate >= 0.35) return 'var(--amber)';
  return 'var(--red)';
}

function renderStats(methods) {
  const arr = Object.values(methods);
  const totalApps = arr.reduce((s,m) => s + (m.total_applications||0), 0);
  const totalDisc = arr.reduce((s,m) => s + (m.discoveries||[]).length, 0);
  const avgRate = totalApps > 0 ? totalDisc / totalApps : 0;
  document.getElementById('s-methods').textContent = arr.length;
  document.getElementById('s-applications').textContent = totalApps;
  document.getElementById('s-discoveries').textContent = totalDisc;
  document.getElementById('s-avg-rate').textContent = (avgRate * 100).toFixed(0) + '%';
}

function renderCategorySummary(methods) {
  const el = document.getElementById('cat-summary');
  const cats = {};
  for (const m of Object.values(methods)) {
    const c = m.category || 'unknown';
    if (!cats[c]) cats[c] = {count:0, discoveries:0, applications:0};
    cats[c].count++;
    cats[c].discoveries += (m.discoveries||[]).length;
    cats[c].applications += m.total_applications||0;
  }
  el.innerHTML = Object.entries(cats).map(([cat, d]) => {
    const col = CAT_COLORS[cat] || {bg:'rgba(255,255,255,0.04)',fg:'var(--dim)'};
    return `<div class="cat-chip" style="background:${col.bg};color:${col.fg}">
      <div class="cat-chip-name">${esc(CAT_LABELS[cat]||cat)}</div>
      <div class="cat-chip-count">${d.count}</div>
      <div class="cat-chip-disc">${d.discoveries} disc / ${d.applications} apps</div>
    </div>`;
  }).join('');
}

function renderFilters(methods) {
  const el = document.getElementById('cat-filters');
  const cats = new Set(Object.values(methods).map(m => m.category));
  el.innerHTML = '<button class="cat-btn active" data-cat="all">All</button>' +
    [...cats].map(c => `<button class="cat-btn" data-cat="${c}">${esc(CAT_LABELS[c]||c)}</button>`).join('');
  el.querySelectorAll('.cat-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      activeCategory = btn.dataset.cat;
      el.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderMethods(allData.methodologies);
    });
  });
}

function renderMethods(methods) {
  const el = document.getElementById('method-list');
  const entries = Object.entries(methods)
    .filter(([,m]) => activeCategory === 'all' || m.category === activeCategory)
    .sort((a,b) => {
      const ra = successRate(a[1]), rb = successRate(b[1]);
      const da = (a[1].discoveries||[]).length, db = (b[1].discoveries||[]).length;
      return db - da || rb - ra;
    });

  if (!entries.length) { el.innerHTML = '<div class="empty">No methods in this category</div>'; return; }

  el.innerHTML = entries.map(([id, m]) => {
    const rate = successRate(m);
    const ci = confidenceInterval(m);
    const col = rateColor(rate);

    // Discoveries
    const discs = (m.discoveries||[]).slice(-5);
    const discHtml = discs.length ? '<div class="discovery-list">' + discs.map(d =>
      `<div class="disc-item">
        <span class="disc-cycle">C${d.cycle||'?'}</span>
        <span class="disc-desc">${esc(d.description||'')}</span>
        ${d.score ? `<span class="disc-score">${d.score}</span>` : ''}
      </div>`
    ).join('') + '</div>' : '';

    // Confidence interval bar
    const ciLow = ci.low * 100;
    const ciHigh = ci.high * 100;
    const ciWidth = ciHigh - ciLow;

    return `<div class="glass method-card">
      <div class="method-header">
        <span class="method-name">${esc(m.name)}</span>
        <span class="method-cat cat-${m.category}">${esc(CAT_LABELS[m.category]||m.category)}</span>
      </div>
      <div class="method-desc">${esc(m.description)}</div>
      <div class="rate-row">
        <span class="rate-label">Success Rate</span>
        <div class="rate-bar-bg">
          <div class="rate-ci" style="left:${ciLow}%;width:${ciWidth}%"></div>
          <div class="rate-bar-fill" style="width:${rate*100}%;background:${col}"></div>
        </div>
        <span class="rate-val" style="color:${col}">${(rate*100).toFixed(0)}%</span>
      </div>
      <div class="method-stats">
        <span class="ms"><strong>${m.total_applications||0}</strong> applications</span>
        <span class="ms"><strong>${(m.discoveries||[]).length}</strong> discoveries</span>
        <span class="ms"><strong>${(m.null_results||[]).length}</strong> null results</span>
        <span class="ms">CI: [${(ci.low*100).toFixed(0)}%, ${(ci.high*100).toFixed(0)}%]</span>
        <span class="ms">Status: <strong>${m.status||'active'}</strong></span>
      </div>
      ${discHtml}
    </div>`;
  }).join('');
}

function renderExploration(methods) {
  const el = document.getElementById('explore-list');
  const section = document.getElementById('explore-section');

  const candidates = Object.entries(methods)
    .filter(([,m]) => m.status === 'active')
    .map(([id, m]) => {
      const ci = confidenceInterval(m);
      return {id, m, width: ci.high - ci.low, mean: ci.mean};
    })
    .filter(c => c.width >= 0.4)
    .sort((a,b) => b.width - a.width);

  if (!candidates.length) { section.style.display = 'none'; return; }
  section.style.display = '';

  el.innerHTML = candidates.map(c => {
    const needed = Math.max(1, 5 - (c.m.total_applications||0));
    return `<div class="explore-card">
      <div class="explore-header">
        <span class="explore-name">${esc(c.m.name)}</span>
        <span class="explore-meta">${c.m.total_applications||0} apps, CI width: ${(c.width*100).toFixed(0)}%</span>
      </div>
      <div class="explore-rec">Need ~${needed} more trials to narrow confidence interval. Current estimate: ${(c.mean*100).toFixed(0)}%</div>
    </div>`;
  }).join('');
}

function renderAllocation(methods) {
  const el = document.getElementById('alloc-chart');
  const active = Object.entries(methods).filter(([,m]) => m.status === 'active');
  if (!active.length) return;

  // Simple Thompson sampling approximation for display
  const samples = active.map(([id, m]) => {
    const a = m.alpha||1, b = m.beta||1;
    const mean = a / (a + b);
    const n = m.total_applications||0;
    const bonus = n < 3 ? 0.2 : n < 6 ? 0.1 : n < 10 ? 0.05 : 0;
    return {id, name: m.name, score: Math.min(1, mean + bonus)};
  });

  const total = samples.reduce((s,x) => s + x.score, 0);
  samples.sort((a,b) => b.score - a.score);

  el.innerHTML = samples.map(s => {
    const pct = (s.score / total * 100);
    return `<div class="alloc-row">
      <span class="alloc-name" title="${esc(s.name)}">${esc(s.name)}</span>
      <div class="alloc-bar-bg"><div class="alloc-bar-fill" style="width:${pct}%"></div></div>
      <span class="alloc-val">${pct.toFixed(0)}%</span>
    </div>`;
  }).join('');
}

function renderCycleLog(log) {
  const el = document.getElementById('cycle-log');
  if (!log || !log.length) { el.innerHTML = '<div class="empty">No application log</div>'; return; }
  const recent = log.slice(-15).reverse();
  el.innerHTML = recent.map(entry => {
    const icon = entry.produced_discovery ? '&#x2713;' : '&#x2717;';
    const col = entry.produced_discovery ? 'var(--green)' : 'var(--red)';
    return `<div class="disc-item">
      <span style="color:${col};font-weight:700;min-width:16px">${icon}</span>
      <span class="disc-cycle">C${entry.cycle||'?'}</span>
      <span class="disc-desc">${esc(entry.method_id)} ${entry.description ? '— ' + esc(entry.description) : ''}</span>
    </div>`;
  }).join('');
}

async function refresh() {
  try {
    const r = await fetch(TRACKER_URL + '?t=' + Date.now());
    if (!r.ok) return;
    allData = await r.json();
    const methods = allData.methodologies || {};
    renderStats(methods);
    renderCategorySummary(methods);
    renderFilters(methods);
    renderMethods(methods);
    renderExploration(methods);
    renderAllocation(methods);
    renderCycleLog(allData.cycle_log || []);
  } catch {}
}

refresh();
setInterval(refresh, 10000);
</script>
</body>
</html>
