<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Economic Research Engine</title>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2e;
    --text: #e0e0e0;
    --dim: #6b6b80;
    --accent: #4fc3f7;
    --green: #66bb6a;
    --red: #ef5350;
    --yellow: #ffa726;
    --purple: #ab47bc;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    background: var(--bg);
    color: var(--text);
    font-size: 13px;
    line-height: 1.5;
  }
  .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
  header {
    border-bottom: 1px solid var(--border);
    padding-bottom: 16px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  h1 { font-size: 16px; font-weight: 600; color: var(--accent); }
  .meta { color: var(--dim); font-size: 11px; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 24px; }
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 16px;
  }
  .card h2 {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--dim);
    margin-bottom: 12px;
  }
  .stat { font-size: 28px; font-weight: 700; color: var(--accent); }
  .stat-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
  .stat-label { color: var(--dim); }
  .stat-value { font-weight: 600; }

  .opportunity {
    border-bottom: 1px solid var(--border);
    padding: 12px 0;
  }
  .opportunity:last-child { border-bottom: none; }
  .opp-header { display: flex; justify-content: space-between; align-items: center; }
  .opp-name { font-weight: 600; }
  .opp-score {
    background: var(--accent);
    color: var(--bg);
    padding: 2px 8px;
    border-radius: 3px;
    font-weight: 700;
    font-size: 12px;
  }
  .opp-thesis { color: var(--dim); margin-top: 4px; font-size: 12px; }
  .opp-meta { display: flex; gap: 12px; margin-top: 6px; font-size: 11px; }
  .tag {
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
  }
  .tag-h1 { background: #1b5e20; color: #a5d6a7; }
  .tag-h2 { background: #e65100; color: #ffcc80; }
  .tag-h3 { background: #4a148c; color: #ce93d8; }
  .tag-principle { background: var(--border); color: var(--dim); }

  .signal {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 12px;
  }
  .signal:last-child { border-bottom: none; }
  .signal-score {
    min-width: 28px;
    text-align: center;
    font-weight: 700;
  }
  .signal-score.high { color: var(--green); }
  .signal-score.med { color: var(--yellow); }
  .signal-score.low { color: var(--red); }
  .signal-headline { flex: 1; }
  .signal-source { color: var(--dim); font-size: 11px; min-width: 100px; text-align: right; }
  .signal-status {
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 3px;
    min-width: 70px;
    text-align: center;
  }
  .status-new { background: #0d47a1; color: #90caf9; }
  .status-graded { background: #1b5e20; color: #a5d6a7; }
  .status-forwarded { background: #e65100; color: #ffcc80; }
  .status-verified { background: #4a148c; color: #ce93d8; }
  .status-killed { background: #b71c1c; color: #ef9a9a; }

  .heatmap { display: flex; flex-wrap: wrap; gap: 6px; }
  .heat-cell {
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
  }
  .heat-count { font-weight: 700; font-size: 16px; }
  .heat-label { color: var(--dim); font-size: 10px; }

  .empty-state {
    text-align: center;
    padding: 40px;
    color: var(--dim);
  }
  .empty-state .icon { font-size: 32px; margin-bottom: 12px; }
  .pulse { animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

  .cycle-bar { display: flex; gap: 4px; align-items: flex-end; height: 60px; }
  .cycle-col {
    flex: 1;
    background: var(--accent);
    border-radius: 2px 2px 0 0;
    opacity: 0.6;
    min-width: 20px;
    position: relative;
  }
  .cycle-col:hover { opacity: 1; }
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>AI ECONOMIC RESEARCH ENGINE</h1>
      <div class="meta">Infrastructure Overhang / Incumbent Kill / Dead Revival</div>
    </div>
    <div style="text-align: right;">
      <div class="meta">Cycle <span id="cycle-num">0</span></div>
      <div class="meta">Updated: <span id="last-updated">—</span></div>
      <div class="meta pulse" id="status-indicator">IDLE</div>
    </div>
  </header>

  <div class="grid-3">
    <div class="card">
      <h2>Signals Scanned</h2>
      <div class="stat" id="total-signals">0</div>
    </div>
    <div class="card">
      <h2>Opportunities Verified</h2>
      <div class="stat" id="total-verified">0</div>
    </div>
    <div class="card">
      <h2>Active Pipeline</h2>
      <div class="stat" id="active-pipeline">0</div>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Top Opportunities</h2>
      <div id="opportunities-list">
        <div class="empty-state">
          <div class="icon">~</div>
          <div>No opportunities yet. Run first research cycle.</div>
        </div>
      </div>
    </div>
    <div class="card">
      <h2>Recent Signals</h2>
      <div id="signals-list">
        <div class="empty-state">
          <div class="icon">~</div>
          <div>No signals yet. Awaiting Agent A scan.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Sector Heatmap</h2>
      <div id="sector-heatmap" class="heatmap">
        <div class="empty-state" style="width:100%"><div class="icon">~</div>No data</div>
      </div>
    </div>
    <div class="card">
      <h2>Geography Heatmap</h2>
      <div id="geo-heatmap" class="heatmap">
        <div class="empty-state" style="width:100%"><div class="icon">~</div>No data</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Cycle History</h2>
    <div id="cycle-history" class="cycle-bar">
      <div class="empty-state" style="width:100%"><div class="icon">~</div>No cycles completed</div>
    </div>
  </div>
</div>

<script>
const DATA_BASE = '../data/ui';
const REFRESH_INTERVAL = 5000;

async function fetchJSON(path) {
  try {
    const res = await fetch(path + '?t=' + Date.now());
    if (!res.ok) return null;
    return await res.json();
  } catch { return null; }
}

function renderOpportunities(opps) {
  const el = document.getElementById('opportunities-list');
  if (!opps || opps.length === 0) return;
  el.innerHTML = opps.map(o => `
    <div class="opportunity">
      <div class="opp-header">
        <span class="opp-name">${o.name}</span>
        <span class="opp-score">${o.score}</span>
      </div>
      <div class="opp-thesis">${o.thesis}</div>
      <div class="opp-meta">
        <span class="tag tag-${o.horizon.toLowerCase()}">${o.horizon}</span>
        ${(o.principles_passed || []).map(p => `<span class="tag tag-principle">${p}</span>`).join('')}
        <span style="color: var(--dim)">${o.status}</span>
      </div>
    </div>
  `).join('');
}

function renderSignals(signals) {
  const el = document.getElementById('signals-list');
  if (!signals || signals.length === 0) return;
  el.innerHTML = signals.slice(0, 20).map(s => {
    const scoreClass = s.relevance_score >= 7 ? 'high' : s.relevance_score >= 4 ? 'med' : 'low';
    return `
      <div class="signal">
        <div class="signal-score ${scoreClass}">${s.relevance_score}</div>
        <div class="signal-headline">${s.headline}</div>
        <div class="signal-source">${s.source || s.category}</div>
        <div class="signal-status status-${s.status}">${s.status}</div>
      </div>
    `;
  }).join('');
}

function renderHeatmap(data, elementId) {
  const el = document.getElementById(elementId);
  if (!data || Object.keys(data).length === 0) return;
  const maxCount = Math.max(...Object.values(data).map(d => d.signal_count || 0), 1);
  el.innerHTML = Object.entries(data).map(([name, d]) => {
    const intensity = Math.round((d.signal_count / maxCount) * 200 + 55);
    return `
      <div class="heat-cell" style="background: rgba(79,195,247,${d.signal_count/maxCount*0.5 + 0.1})">
        <div class="heat-count">${d.signal_count}</div>
        <div class="heat-label">${name}</div>
      </div>
    `;
  }).join('');
}

function renderCycleHistory(cycles) {
  const el = document.getElementById('cycle-history');
  if (!cycles || cycles.length === 0) return;
  const maxSignals = Math.max(...cycles.map(c => c.signals || 0), 1);
  el.innerHTML = cycles.map(c => `
    <div class="cycle-col" style="height: ${(c.signals/maxSignals)*100}%"
         title="Cycle ${c.cycle}: ${c.signals} signals, ${c.verified} verified, top: ${c.top_score}">
    </div>
  `).join('');
}

async function refresh() {
  const dashboard = await fetchJSON(DATA_BASE + '/dashboard.json');
  const feed = await fetchJSON(DATA_BASE + '/signals_feed.json');

  if (dashboard) {
    document.getElementById('cycle-num').textContent = dashboard.current_cycle;
    document.getElementById('last-updated').textContent =
      dashboard.last_updated ? new Date(dashboard.last_updated).toLocaleString() : '—';
    document.getElementById('total-signals').textContent = dashboard.total_signals_scanned;
    document.getElementById('total-verified').textContent = dashboard.total_opportunities_verified;
    document.getElementById('active-pipeline').textContent = dashboard.active_opportunities;
    renderOpportunities(dashboard.top_opportunities);
    renderHeatmap(dashboard.sector_heatmap, 'sector-heatmap');
    renderHeatmap(dashboard.geography_heatmap, 'geo-heatmap');
    renderCycleHistory(dashboard.cycle_history);
  }

  if (feed) {
    renderSignals(feed.recent_signals);
  }

  document.getElementById('status-indicator').textContent =
    dashboard && dashboard.current_cycle > 0 ? 'RUNNING' : 'IDLE';
}

refresh();
setInterval(refresh, REFRESH_INTERVAL);
</script>
</body>
</html>
